{"ast":null,"code":"var _jsxFileName = \"/home/luis/Escritorio/React/MERN/client/src/contexts/AuthContext.js\",\n  _s = $RefreshSig$();\nimport { useState, useEffect, createContext } from \"react\";\nimport { Auth, User } from \"../api\";\nimport { hasExpiredToken } from \"../utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst userController = new User();\nconst authController = new Auth();\nexport const AuthContext = /*#__PURE__*/createContext();\nexport function AuthProvider(props) {\n  _s();\n  const {\n    children\n  } = props;\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    // Comprobar si el usuario está logueado\n    (async () => {\n      const accessToken = authController.getAccessToken();\n      const refreshToken = authController.getRefreshToken();\n      if (!accessToken || !refreshToken) {\n        logout();\n        setLoading(false);\n        return;\n      }\n      if (hasExpiredToken(accessToken)) {\n        console.log(\"access\");\n        // Ha Caducado\n        if (hasExpiredToken(refreshToken)) {\n          console.log(\"refresh\");\n          logout();\n        } else {\n          await reLogin(refreshToken);\n        }\n      } else {\n        await login(accessToken);\n      }\n      setLoading(false);\n    })();\n  }); // [] );\n\n  const reLogin = async refreshToken => {\n    try {\n      const {\n        accessToken\n      } = await authController.refreshAccesToken(refreshToken);\n      authController.setAccessToken(accessToken);\n      await login(accessToken);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n  const login = async accessToken => {\n    try {\n      const response = await userController.getMe(accessToken);\n      setUser(response);\n      setToken(accessToken);\n    } catch (error) {\n      throw error;\n    }\n  };\n  const logout = () => {\n    setUser(null);\n    setToken(null);\n    authController.removeTokens();\n  };\n  const data = {\n    accessToken: token,\n    user,\n    login,\n    logout\n  };\n  if (loading) return null;\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: data,\n    children: [\" \", children, \" \"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 12\n  }, this);\n}\n_s(AuthProvider, \"uAkFQMmIUxfxJcQTEb8tCM/KFt4=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["useState","useEffect","createContext","Auth","User","hasExpiredToken","userController","authController","AuthContext","AuthProvider","props","children","user","setUser","token","setToken","loading","setLoading","accessToken","getAccessToken","refreshToken","getRefreshToken","logout","console","log","reLogin","login","refreshAccesToken","setAccessToken","error","response","getMe","removeTokens","data"],"sources":["/home/luis/Escritorio/React/MERN/client/src/contexts/AuthContext.js"],"sourcesContent":["import { useState, useEffect, createContext} from \"react\";\nimport { Auth, User } from \"../api\";\nimport { hasExpiredToken } from \"../utils\";\n\nconst userController = new User();\nconst authController = new Auth();\n\nexport const AuthContext = createContext();\n\nexport function AuthProvider(props) {\n    const { children } = props;\n    const [user, setUser] = useState(null)\n    const [token, setToken] = useState(null)\n    const [loading, setLoading] = useState(true)\n        \n    useEffect(()=> {\n        // Comprobar si el usuario está logueado\n        (async ()=> {\n            const accessToken = authController.getAccessToken() ;\n            const refreshToken = authController.getRefreshToken() ;\n\n            \n            if (!accessToken || !refreshToken) {\n            logout();\n            setLoading(false);\n            return;\n        }\n        \n        if (hasExpiredToken(accessToken)) {\n            console.log(\"access\");\n            // Ha Caducado\n            if (hasExpiredToken(refreshToken)) {\n                console.log(\"refresh\");\n                logout();\n            } else {\n                await reLogin(refreshToken);\n            }\n        } else {\n            await login(accessToken);\n        }\n        \n        setLoading(false);\n       })();\n    } ); // [] );\n\n    const reLogin = async (refreshToken) => {\n        try {\n            \n            const {accessToken} = await authController.refreshAccesToken(refreshToken);\n            authController.setAccessToken(accessToken);\n            await login(accessToken);\n\n        } catch (error) {\n            console.error(error);\n        }\n    }\n\n    const login = async (accessToken) => {\n        try {\n            const response = await userController.getMe(accessToken);\n            setUser(response)\n            setToken(accessToken)\n        } catch (error) {\n            throw error;\n        }\n    }\n\n    const logout = () => {\n        setUser(null);\n        setToken(null);\n        authController.removeTokens();\n    }\n\n    const data = {\n        accessToken: token,\n        user,\n        login,\n        logout\n    }\n\n    if (loading) return null ;\n\n    return <AuthContext.Provider value={data}> {children} </AuthContext.Provider>\n}\n\n"],"mappings":";;AAAA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,aAAa,QAAO,OAAO;AACzD,SAASC,IAAI,EAAEC,IAAI,QAAQ,QAAQ;AACnC,SAASC,eAAe,QAAQ,UAAU;AAAC;AAE3C,MAAMC,cAAc,GAAG,IAAIF,IAAI,EAAE;AACjC,MAAMG,cAAc,GAAG,IAAIJ,IAAI,EAAE;AAEjC,OAAO,MAAMK,WAAW,gBAAGN,aAAa,EAAE;AAE1C,OAAO,SAASO,YAAY,CAACC,KAAK,EAAE;EAAA;EAChC,MAAM;IAAEC;EAAS,CAAC,GAAGD,KAAK;EAC1B,MAAM,CAACE,IAAI,EAAEC,OAAO,CAAC,GAAGb,QAAQ,CAAC,IAAI,CAAC;EACtC,MAAM,CAACc,KAAK,EAAEC,QAAQ,CAAC,GAAGf,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAACgB,OAAO,EAAEC,UAAU,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EAE5CC,SAAS,CAAC,MAAK;IACX;IACA,CAAC,YAAW;MACR,MAAMiB,WAAW,GAAGX,cAAc,CAACY,cAAc,EAAE;MACnD,MAAMC,YAAY,GAAGb,cAAc,CAACc,eAAe,EAAE;MAGrD,IAAI,CAACH,WAAW,IAAI,CAACE,YAAY,EAAE;QACnCE,MAAM,EAAE;QACRL,UAAU,CAAC,KAAK,CAAC;QACjB;MACJ;MAEA,IAAIZ,eAAe,CAACa,WAAW,CAAC,EAAE;QAC9BK,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAC;QACrB;QACA,IAAInB,eAAe,CAACe,YAAY,CAAC,EAAE;UAC/BG,OAAO,CAACC,GAAG,CAAC,SAAS,CAAC;UACtBF,MAAM,EAAE;QACZ,CAAC,MAAM;UACH,MAAMG,OAAO,CAACL,YAAY,CAAC;QAC/B;MACJ,CAAC,MAAM;QACH,MAAMM,KAAK,CAACR,WAAW,CAAC;MAC5B;MAEAD,UAAU,CAAC,KAAK,CAAC;IAClB,CAAC,GAAG;EACP,CAAC,CAAE,CAAC,CAAC;;EAEL,MAAMQ,OAAO,GAAG,MAAOL,YAAY,IAAK;IACpC,IAAI;MAEA,MAAM;QAACF;MAAW,CAAC,GAAG,MAAMX,cAAc,CAACoB,iBAAiB,CAACP,YAAY,CAAC;MAC1Eb,cAAc,CAACqB,cAAc,CAACV,WAAW,CAAC;MAC1C,MAAMQ,KAAK,CAACR,WAAW,CAAC;IAE5B,CAAC,CAAC,OAAOW,KAAK,EAAE;MACZN,OAAO,CAACM,KAAK,CAACA,KAAK,CAAC;IACxB;EACJ,CAAC;EAED,MAAMH,KAAK,GAAG,MAAOR,WAAW,IAAK;IACjC,IAAI;MACA,MAAMY,QAAQ,GAAG,MAAMxB,cAAc,CAACyB,KAAK,CAACb,WAAW,CAAC;MACxDL,OAAO,CAACiB,QAAQ,CAAC;MACjBf,QAAQ,CAACG,WAAW,CAAC;IACzB,CAAC,CAAC,OAAOW,KAAK,EAAE;MACZ,MAAMA,KAAK;IACf;EACJ,CAAC;EAED,MAAMP,MAAM,GAAG,MAAM;IACjBT,OAAO,CAAC,IAAI,CAAC;IACbE,QAAQ,CAAC,IAAI,CAAC;IACdR,cAAc,CAACyB,YAAY,EAAE;EACjC,CAAC;EAED,MAAMC,IAAI,GAAG;IACTf,WAAW,EAAEJ,KAAK;IAClBF,IAAI;IACJc,KAAK;IACLJ;EACJ,CAAC;EAED,IAAIN,OAAO,EAAE,OAAO,IAAI;EAExB,oBAAO,QAAC,WAAW,CAAC,QAAQ;IAAC,KAAK,EAAEiB,IAAK;IAAA,WAAC,GAAC,EAACtB,QAAQ,EAAC,GAAC;EAAA;IAAA;IAAA;IAAA;EAAA,QAAuB;AACjF;AAAC,GA1EeF,YAAY;AAAA,KAAZA,YAAY;AAAA;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}